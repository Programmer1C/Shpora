
&НаКлиенте
Процедура Расчитать(Команда)
	РасчитатьНаСервере();
КонецПроцедуры

&НаСервере
Процедура РасчитатьНаСервере()
	
	ТекДокумент = РеквизитФормыВЗначение("Объект");
	Движения = ТекДокумент.Движения;
	
		// регистр ОсновныеНачисления
	Движения.ОсновныеНачисления.Записывать = Истина;
	Для Каждого ТекСтрокаОсновныеНачисления Из Объект.ОсновныеНачисления Цикл
		Движение = Движения.ОсновныеНачисления.Добавить();
		Движение.Сторно = Ложь;
		Движение.Сотрудник = ТекСтрокаОсновныеНачисления.Сотрудник;
		Движение.Подразделение = ТекСтрокаОсновныеНачисления.Подразделение;
		Движение.ВидРасчета = ТекСтрокаОсновныеНачисления.ВидРасчета;
		Движение.ПериодДействияНачало = ТекСтрокаОсновныеНачисления.ПериодДействияНачало;
		Движение.ПериодДействияКонец = КонецДня(ТекСтрокаОсновныеНачисления.ПериодДействияКонец);
		Движение.ПериодРегистрации = Объект.Дата;
		Движение.График = ТекСтрокаОсновныеНачисления.График;
	КонецЦикла;

	// регистр ДополнительныеНачисления
	Движения.ДополнительныеНачисления.Записывать = Истина;
	Для Каждого ТекСтрокаДополнительныеНачисления Из Объект.ДополнительныеНачисления Цикл
		Движение = Движения.ДополнительныеНачисления.Добавить();
		Движение.Сторно = Ложь;
		Движение.Сотрудник = ТекСтрокаДополнительныеНачисления.Сотрудник;
		Движение.Подразделение = ТекСтрокаДополнительныеНачисления.Подразделение;
		Движение.ВидРасчета = ТекСтрокаДополнительныеНачисления.ВидРасчета;
		Движение.ПериодРегистрации = Объект.Дата;
		Движение.БазовыйПериодНачало = НачалоМесяца(Объект.Дата);
		Движение.БазовыйПериодКонец = КонецМесяца(Объект.Дата);
	КонецЦикла;
	
	Движения.Записать();
	
	Расчеты.Рассчитать(Объект.Ссылка, Объект.Дата, Движения);
	
	Объект.ОсновныеНачисления.Очистить();
	Объект.ДополнительныеНачисления.Очистить();
	
	Объект.ОсновныеНачисления.Загрузить(Движения.ОсновныеНачисления.Выгрузить());
	Объект.ДополнительныеНачисления.Загрузить(Движения.ДополнительныеНачисления.Выгрузить());

	Движения.ОсновныеНачисления.Очистить();
	Движения.ДополнительныеНачисления.Очистить();
	
	Движения.ОсновныеНачисления.Записать();
	Движения.ДополнительныеНачисления.Записать();  

КонецПроцедуры

